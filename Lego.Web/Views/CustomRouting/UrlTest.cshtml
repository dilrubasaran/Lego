@{
    ViewData["Title"] = "URL Parser Test";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <h1>üîß URL Parser Test Sayfasƒ±</h1>
            <p class="text-muted">
                Custom Routing sisteminin URL parsing √∂zelliklerini test edebilirsiniz.
            </p>
            
            <!-- URL Test Formu -->
            <div class="card">
                <div class="card-header">
                    <h5>URL Test Formu</h5>
                </div>
                <div class="card-body">
                    <form id="urlTestForm">
                        <div class="mb-3">
                            <label for="urlInput" class="form-label">Test edilecek URL:</label>
                            <input type="text" class="form-control" id="urlInput" placeholder="√ñrn: /category/1" autocomplete="off">
                            <div class="form-text">
                                Kategoriler i√ßin: <code>/category/{id}</code><br>
                                √úr√ºnler i√ßin: <code>/category/{categoryId}/product/{productId}</code>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">URL'yi Test Et</button>
                        <button type="button" class="btn btn-secondary" onclick="clearResults()">Temizle</button>
                    </form>
                </div>
            </div>
            
            <!-- Test Sonu√ßlarƒ± -->
            <div id="testResults" class="mt-4" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Sonu√ßlarƒ±</h5>
                    </div>
                    <div class="card-body">
                        <div id="resultContent"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- √ñrnek URL'ler -->
            <div class="card">
                <div class="card-header">
                    <h5>üí° √ñrnek URL'ler</h5>
                </div>
                <div class="card-body">
                    <p class="small">A≈üaƒüƒ±daki √∂rnekleri test edebilirsiniz:</p>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="testUrl('/category/1')">
                            /category/1
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="testUrl('/category/1/product/5')">
                            /category/1/product/5
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="testUrl('/invalid-url')">
                            /invalid-url (Ge√ßersiz)
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="testUrl('/category/999')">
                            /category/999 (Mevcut deƒüil)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- URL Format A√ßƒ±klamasƒ± -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6>üìã URL Format Kurallarƒ±</h6>
                </div>
                <div class="card-body">
                    <div class="small">
                        <strong>Kategori URL:</strong><br>
                        <code>/category/{id}</code><br>
                        <em>id: pozitif sayƒ±</em><br><br>
                        
                        <strong>√úr√ºn URL:</strong><br>
                        <code>/category/{categoryId}/product/{productId}</code><br>
                        <em>categoryId ve productId: pozitif sayƒ±lar</em><br><br>
                        
                        <strong>Avantajlar:</strong><br>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ Hiyerar≈üik URL yapƒ±sƒ±</li>
                            <li>‚Ä¢ SEO dostu</li>
                            <li>‚Ä¢ Kategori baƒülamƒ±nƒ± korur</li>
                            <li>‚Ä¢ Kullanƒ±cƒ± dostu navigasyon</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Navigasyon -->
            <div class="card mt-3">
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="/CustomRouting" class="btn btn-success">
                            üè† Ana Sayfaya D√∂n
                        </a>
                        <a href="/api/custom-routing/categories" target="_blank" class="btn btn-info">
                            üìä API JSON G√∂r√ºn√ºm√º
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('urlTestForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const url = document.getElementById('urlInput').value.trim();
    if (url) {
        testUrlInternal(url);
    } else {
        alert('L√ºtfen bir URL girin');
    }
});

function testUrl(url) {
    document.getElementById('urlInput').value = url;
    testUrlInternal(url);
}

function testUrlInternal(url) {
    fetch('/CustomRouting/ParseUrl', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'url=' + encodeURIComponent(url)
    })
    .then(response => response.json())
    .then(data => {
        showResults(data, url);
    })
    .catch(error => {
        console.error('Error:', error);
        alert('URL test edilirken hata olu≈ütu');
    });
}

function showResults(data, originalUrl) {
    const resultDiv = document.getElementById('resultContent');
    const testResults = document.getElementById('testResults');
    
    let html = `
        <div class="mb-3">
            <strong>Test Edilen URL:</strong> <code>${originalUrl}</code>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <h6>Parse Sonucu:</h6>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Tip:</span>
                        <span class="badge ${data.Type === 'Category' ? 'bg-primary' : data.Type === 'Product' ? 'bg-success' : 'bg-danger'}">${data.Type}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Ge√ßerli:</span>
                        <span class="badge ${data.IsValid ? 'bg-success' : 'bg-danger'}">${data.IsValid ? 'Evet' : 'Hayƒ±r'}</span>
                    </li>`;
    
    if (data.CategoryId) {
        html += `
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Kategori ID:</span>
                        <span class="badge bg-info">${data.CategoryId}</span>
                    </li>`;
    }
    
    if (data.ProductId) {
        html += `
                    <li class="list-group-item d-flex justify-content-between">
                        <span>√úr√ºn ID:</span>
                        <span class="badge bg-info">${data.ProductId}</span>
                    </li>`;
    }
    
    html += `</ul>
            </div>
            <div class="col-md-6">`;
    
    if (data.Data) {
        html += `
                <h6>Veri:</h6>
                <div class="card">
                    <div class="card-body">
                        <pre class="small">${JSON.stringify(data.Data, null, 2)}</pre>
                    </div>
                </div>`;
        
        if (data.Url) {
            html += `
                <div class="mt-2">
                    <strong>Olu≈üturulan URL:</strong><br>
                    <code>${data.Url}</code>
                </div>`;
        }
    }
    
    if (data.Message) {
        html += `
                <div class="alert alert-info small">
                    ${data.Message}
                </div>`;
    }
    
    html += `
            </div>
        </div>`;
    
    resultDiv.innerHTML = html;
    testResults.style.display = 'block';
    
    // Scroll to results
    testResults.scrollIntoView({ behavior: 'smooth' });
}

function clearResults() {
    document.getElementById('urlInput').value = '';
    document.getElementById('testResults').style.display = 'none';
}
</script>
